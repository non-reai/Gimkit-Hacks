var socket = null;
var lastDataSent = null;
var using = null;
var answer = false;

const nativeSend = window.WebSocket.prototype.send;
window.WebSocket.prototype.send = function(data) {
	nativeSend.call(this, data);
	var enc = new TextDecoder("utf-8");
	if (data != 2 && enc.decode(data).includes("answer")) {
		lastDataSent = data;
	}
	socket = this;
};

document.onkeydown = (e) => {
	if (e.repeat) {
		return;
	}
	if (e.key == ";") {
		using = lastDataSent;
		alert("Saved.");
	} else if (e.key == "u") {
		if (answer) {
			answer = false;
		} else {
			answer = true;
		};
	};
};

async function answerQuestion() {
	if (using && answer) {
		socket.send(using);
	};
	await new Promise(resolve=>{
		setTimeout(resolve,Math.random() * (2000 - 500) + 500);
	});
	answerQuestion();
};
alert(Object.isFrozen(window.WebSocket.prototype)?"Refresh and try again.":"Started.");
answerQuestion();


